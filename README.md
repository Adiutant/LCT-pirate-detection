# LCT-pirate-detection
Хакатон "Лидеры Цифровой Трансформации" 
## Сервис проверки видеофайлов на нарушение авторских прав
## Команда
- Легоньков Роман
- Шерри Георгий 
- Деев Леонид
- Парфёнов Егор
- Комолов Тимур
## Запуск приложения
### Запуск ML сервиса
```
docker build -t image_ml -f Dockerfile .
```
### Запуск и документация клиентского приложения
[Клиентское приложение](rutube/README.md)
### Запуск и документация Backend
[Серверное приложение](lct-backend/README.md)
## Описание решения
Решение задачи по обнаружению пиратства в видеофайлах представляет собой сервис, который позволяет проверить видеофайл
на наличие лицензионного контента. На клиентской стороне пользователь загружает видеофайл, который отправляется на сервер.
На сервере видеофайл сохраняется в отдельную базу данных и отправляется в сервис с машинным обучением.

## Сервис с машинным обучением

### Сравнительная таблица ViT, ResNet, сверточная сиамская модель для создания слепков видеоконтента
|   | ViT  | ResNet | Сиамская модель |
| ------------ | ------------ | ------------ | ------------ |
| Описание   | Модель глубокого обучения, использующая трансформеры для обработки изображений путем разбиения изображения на патчи и кодировании их векторами, достигая высокой точности в задачах компьютерного зрения.  | Модель глубокого обучения, в которой используются блоки с пропуском (skip connections), позволяющие эффективно обучать глубокие нейронные сети, преодолевая проблему затухания градиента | Комплекс из двух моделей, обученных на интервалах с взаимствованиями из изначального датасета |
| Требования к памяти  | vRAM: 8 Gb (inference) | vRAM: <=1 Gb (inference) | vRAM: <=1 Gb (inference) |
| Скорость работы  | Быстро | Быстро | Очень быстро |
| Потенциал к масштабированию  | Очень высокий | Высокий | Высокий |

### Сравнительная таблица PANNS и использование спектрограммы для создания слепков аудиоконтента
|   | PANNS | Спектрограмма |
| ------------ | ------------ | ------------ |
| Описание   | Модель для распознавания звуков, использующий псевдо-внимание и обучение на зашумленных данных для улучшения производительности в условиях ограниченной разметки  | Представление звукового сигнала в частотно-временном представлении, определяющее распределение частотной составляющей аудио сигнала во времени |
| Требования к памяти  | vRAM: ~5 Gb (inference) | RAM: <=1 Gb |
| Скорость работы  | Средне | Быстро |
| Потенциал к масштабированию  | Очень высокий | Средний |

В сервисе построена векторная база данных лицензионных видеофайлов. Каждое видео представлено в виде двух векторов: 
вектора видео и вектора аудио.
Вектор видео получен с помощью модели Vision Transformer (ViT) (!!!), а вектор аудио с помощью модели PANNS 
(PANNS: Large-Scale Pretrained Audio Neural Networks for Audio Pattern Recognition).
Эмбеддинги сохраняются в базе данных LanceDB. 


## Процесс работы сервиса
После того, как видеофайл передаётся в сервис, из него извлекаются вектора видео и аудио по 10 секундным сегментам из исходного видеофайла, при этом для видео обрабатывается 1 кадр в секунду. 
Далее, вычисляется косинусное расстояние между векторами видео и аудио загруженного видеофайла и векторами 
лицензионных видеофайлов и осуществляется поиск по векторной базе данных (!!!), находится наиболее похожее видео.
Затем осуществляется сравнение по кадрам в найденном видео и в загруженном. Между массивами эмбеддингов лицензионного и 
пиратского видео вычисляется косинусное расстояние и записи о косинусном расстоянии формируют матрицу схожести. Далее
по строкам матрицы схожести вычисляется спектр схожести первого видео со вторым, а по столбцам вычисляется процент схожести 
второго видео с первым. На спектрах ищутся максимальные пики схожести и по ним вычисляются интервалы заимствования видео.
![peaks](GRAPH.jpg)


### Сравнительный анализ решений по поиску
|   | Косинусное расстояние  | Сиамская модель |
| ------------ | ------------ | ------------ |
| Описание   |   | Комплекс из двух моделей, обученных на интервалах с взаимствованиями из изначального датасета |
| Требования к памяти  |   |   |
| Скорость работы  |   |   |
| Потенциал к масштабированию  |   |   |
| Метрики  |   |   |

## Документация
- [main.py](main_doc.md)
- [ml_service](ml_service_doc.md)



### P.S.
Если вдруг сервис не работает, то пишите t.me/ser13volk.
